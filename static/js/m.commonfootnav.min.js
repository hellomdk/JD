(function(){function o(o,t){if(!o){return}var e;if(!window["_loadCss"]||window["_loadCss"].indexOf(o)<0){e=document.createElement("link");e.setAttribute("type","text/css");e.setAttribute("rel","stylesheet");e.setAttribute("href",o);e.setAttribute("id","loadCss"+Math.random());document.getElementsByTagName("head")[0].appendChild(e);window["_loadCss"]?window["_loadCss"]+="|"+o:window["_loadCss"]="|"+o}e&&typeof t=="function"&&(e.onload=t);return true}function t(o,t){var e=document.createElement("script");t=t||{};e.charset=t.charset||"utf-8";e.onload=e.onreadystatechange=function(){if(/loaded|complete/i.test(this.readyState)||navigator.userAgent.toLowerCase().indexOf("msie")==-1){t.onLoad&&t.onLoad();n()}};e.onerror=function(){t.onError&&t.onError();n()};e.src=o;t.defer&&(e.defer="defer");t.async&&(e.async="async");t.crossorigin&&e.setAttribute("crossorigin","true");document.getElementsByTagName("head")[0].appendChild(e);function n(){if(!e){return}e.onload=e.onreadystatechange=e.onerror=null;e.parentNode&&e.parentNode.removeChild(e);e=null}}function e(o,t,e){var n=new RegExp("([?&]"+t+")=[^&#]*","i");if(n.test(o)){o=o.replace(n,"$1="+e)}else{var i=o.indexOf("#");var a=~o.indexOf("?")?"&":"?";if(i>-1){var r=o.split("#"),c=r[0],s=r[1];o=c+a+t+"="+e+"#"+s}else{o+=a+t+"="+e}}return o}window.global_is_first_load_homepage=0;window.global_find_img=null;window.global_isWaiting=false;window.global_curtains_version="";var n="//wq.360buyimg.com/fd/h5/wxsq_dev/m_common/css/footnav.min.css";var i={HTTP_URL:{MAIN_URL:"//mapi.m.jd.com/bottomNav/getBottomNavigation.action?_format_=json&isNewVersion=1",CART_URL:"//mapi.m.jd.com/cart/cart.json",WAIT_PAY_URL:"//wq.jd.com/user_redpoint/QueryUserRedPoint",ClEAR_WAIT_PAY_URL:"//wq.jd.com/user_redpoint/ClearUserRedPoint"},tabIds:{index:"mCommonHome",category:"mCommonType",find:"mCommonDiscover",cart:"mCommonCart",home:"mCommonMy"},activity:null,iconsMap:{"m.jd.com":"index","staticbeta.m.jd.com":"index","beta-m.m.jd.com":"index","so.m.jd.com":"category","sp.m.jd.com":"find","p.m.jd.com":"cart","plogin.m.jd.com":"home","home.m.jd.com":"home",localhost:"home","localhost:8080":"home"},pgRdMap:{"m.jd.com":"138097.1.6","staticbeta.m.jd.com":"138097.1.6","beta-m.m.jd.com":"138097.1.6","so.m.jd.com":"138097.1.17","plogin.m.jd.com":"138097.1.18","home.m.jd.com":"138097.1.18"},pingData:{index:"MCommonBottom_Home",category:"MCommonBottom_Category",find:"MCommonBottom_Find",cart:"MCommonBottom_Cart",home:"MCommonBottom_My"}};var a=i.HTTP_URL;var r={mPing4Click:function(o,t,e){if(typeof MPing=="undefined"){}else{try{var n=new MPing.inputs.Click(o);n.event_param=t?t:"";n.event_level=e?parseInt(e):"";var i=new MPing;i.send(n)}catch(o){}}},mPing4Exposure:function(o){var t=new Image;if(o){t.src=o}}};function c(o){var t=[];for(var e in o){t.push(encodeURIComponent(e)+"="+encodeURIComponent(o[e]))}t.push("xx="+Math.floor(Math.random()*1e4+500));return t.join("&")}var s={ajax:function(o){var t;try{t=new ActiveXObject("Msxml2.XMLHTTP")}catch(o){try{t=new ActiveXObject("Microsoft.XMLHTTP")}catch(o){t=new XMLHttpRequest}}t.ajaxRunError=true;if(o.withCredentials){try{t.withCredentials=true}catch(o){}}try{t.open(o.method,o.url,o.async);t.onreadystatechange=function(){var e=o.source?o.source:null;if(t.readyState==4){if(t.status==200){t.ajaxRunError=false;var n=t.responseText;o.success.call(e,n)}else{o.error.call(e)}}};if(o.data){t.send(o.data)}else{t.send("{}")}}catch(o){}},jsonp:function(o){var t=o.jsonp;var e=document.getElementsByTagName("head")[0];var n=document.createElement("script");o.data["callback"]=t;var i=c(o.data);e.appendChild(n);n.src=o.url+"?"+i;window[t]=function(i){e.removeChild(n);clearTimeout(n.timer);window[t]=null;o.success&&o.success(i)};if(o.timeout){n.timer=setTimeout(function(){window[t]=null;e.removeChild(n);o.error&&o.error({message:"请求超时"})},o.timeout)}}};var m={getCookie:function(o){var t="";var e=[];var n="^"+o+"=";var i=new RegExp(n,"ig");if(document.cookie){e=document.cookie.split(";");for(var a=0,r=e.length;a<r;a++){if(i.test(e[a].trim())){t=e[a].split("=")[1];break}}}return t},setCookie:function(o,t,e,n,i){var a=o+"="+escape(t);if(e!=""){var r=new Date;r.setTime(r.getTime()+e*24*3600*1e3);a+=";expires="+r.toGMTString()}if(n!=""){a+=";path="+n}if(i!=""){a+=";domain="+i}document.cookie=a},delCookie:function(o){var t=new Date;t.setTime(t.getTime()-1);document.cookie=o+"=; expires="+t.toGMTString()}};var d="//wq.360buyimg.com/js/common/dest/m.discoverToastExport.min.js";var l="//wq.360buyimg.com/js/common/dest/m.indexCurtainExport.min.js?v=201810151951";function u(){this.option={isHidden:false,bgColor:"#fff",isLogin:0,curtainVersion:"0",icons:[{navIcon:{active:"//img11.360buyimg.com/jdphoto/s130x100_jfs/t23527/293/1484991665/3106/de5e0b14/5b617e1cN900db8af.png",def:"//img11.360buyimg.com/jdphoto/s130x100_jfs/t23035/298/1486429409/3876/a61be82c/5b617607N6e80151d.png"},navId:"index",navUrl:"//m.jd.com"},{navIcon:{active:"//img11.360buyimg.com/jdphoto/s130x100_jfs/t21265/259/2608873011/3731/8695ed50/5b617e1cN9b457ad4.png",def:"//img11.360buyimg.com/jdphoto/s130x100_jfs/t21901/89/2695388986/3763/dec8cceb/5b617607N020028c4.png"},navId:"category",navUrl:"//so.m.jd.com/category/all.html"},{navIcon:{active:"//img11.360buyimg.com/jdphoto/s130x100_jfs/t22660/358/1450327256/4156/c325b155/5b617e1cN9214847c.png",def:"//img11.360buyimg.com/jdphoto/s130x100_jfs/t24250/260/1465693932/4768/4b9c36de/5b617608N9d5b6c35.png"},navId:"find",navUrl:"//sp.m.jd.com/discover/index.shtml"},{navIcon:{active:"//img11.360buyimg.com/jdphoto/s130x100_jfs/t20452/163/2691193669/4202/791a2cfe/5b617e1cN651dff31.png",def:"//img11.360buyimg.com/jdphoto/s130x100_jfs/t24043/11/1486965896/4407/5e47882b/5b617608N096f2296.png"},navId:"cart",navUrl:"//p.m.jd.com/cart/cart.action"},{navIcon:{active:"//img11.360buyimg.com/jdphoto/s130x100_jfs/t24160/341/1458466709/3955/36c9ce38/5b617e1cN70e76cdf.png",def:"//img11.360buyimg.com/jdphoto/s130x100_jfs/t20872/267/2715036724/4462/d55edd83/5b617608N004b3ffc.png"},navId:"home",navUrl:"//home.m.jd.com/myJd/home.action"}],bgImage:"xxxxx",curtainsInfo:{},activity:{}};this.isJdPgApp=/jdpingou/.test(navigator.userAgent.toLowerCase())}u.prototype.init=function(){var t=this;console.warn(">>> commonNav 7.6");o(n);var e=localStorage.getItem("m_home_curtains_version");var i=localStorage.getItem("m_home_user_close_curtains");if(i==null){e=null}s.ajax({url:a.MAIN_URL+"&curtainVersion="+e+"&t="+Math.random(),method:"GET",async:true,withCredentials:true,timeout:1200,error:function(){t.showHtml()},success:function(o){t.option=JSON.parse(o);if(t.option.isHidden){if(typeof window.commonNavCallback!="undefined"){console.warn(">>> hidden commonNav.");window.commonNavCallback()}}else{t.showHtml()}}})};u.prototype.showHtml=function(){var o=this.option.icons;var n="";var a="";var r;var c=i.iconsMap[location.host];var s=i.pgRdMap[location.host]||"";var m;var u;var f;var p;var v;var g;var h;if(this.option&&o){for(var w=0,y=o.length;w<y;w++){r=o[w].navId;if(r=="category"){u=location.host=="m.jd.com"?"home ":"bottom";p=e(o[w].navUrl,"searchFrom",u)}else if(r=="find"&&s){p=e(o[w].navUrl,"ptag",s)}else{p=o[w].navUrl}var _=false;if(r=="find"){var b=/\/pingouv\d+\.shtml/;_=b.test(o[w].navUrl)&&b.test(location.pathname)}if(!_){_=r==c}if(_){m=o[w].navIcon.active;p="javascript:void(0)"}else{m=o[w].navIcon.def}h=100/o.length+"%";if(r=="find"&&this.option.activity&&this.option.activity.image){m=this.option.activity.image}n+='<a id="'+i.tabIds[r]+'" '+'style="width: '+h+'"'+'href="'+p+'" '+'class="J_ping" report-eventid="'+i.pingData[r]+'">'+'<div class="icon-center">'+'<img class="nav-img" src="'+m+'" />'+"</div>"+"</a>"}g=this.option.bgColor?this.option.bgColor:"#fff";a=document.createElement("div");a.id="commonNav";a.style.backgroundColor=g;a.innerHTML=n;document.body.appendChild(a);if(this.option.isLogin==0){var j=document.querySelector("#mCommonMy");j.setAttribute("report-eventid","MCommonBottom_NotLogin")}this._sendPingData();window.global_current_viewportHeight=window.innerHeight;window.global_back_to_top;this._compatibleIphoneX();var C=this.option.functionSwitch;if(C&&C.showCartNum){this._showCart()}if(C&&C.showNonPayment){this._showMy()}this._clearMy();var x=this;if(this.option.curtainVersion&&this.option.curtainVersion!="0"){t(l,{onLoad:function(){window.m_indexCurtainExport.showCurtain(x.option)}})}if(this.option.activity){i.activity=this.option.activity;try{switch(i.activity.activityId){case"double11":t(d,{onLoad:function(){window.m_discoverToastExport.showDiscoverToast(i)}});break;case"saleActive":this.saleActive();break;default:break}}catch(o){console.error(">>> 活动加载异常 %o",o)}}}};u.prototype.saleActive=function(o){var t=document.querySelector("#mCommonDiscover");var e=this.option.activity;if(t&&e){if(e.jumpUrl){t.setAttribute("href",e.jumpUrl);var n=e.pingData;if(n){t.setAttribute("report-eventid",n.eventId)}}}};u.prototype._compatibleIphoneX=function(){if(navigator.platform.indexOf("iPhone")>-1){window.addEventListener("orientationchange",function(){if(window.orientation==90||window.orientation==-90){var o=document.querySelector(".cart-num");if(o){o.style.top="-42PX"}}},false)}var o=function(){var o=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;if(o&&(window.screen.width==414&&window.screen.height===896||window.screen.width==375&&window.screen.height===812)){return true}else{return false}}();if(o&&this.isJdPgApp){window.global_bottom_bar_pannel=document.querySelector("#commonNav");window.global_bottom_bar_pannel.style.height="70PX"}if(o&&(navigator.userAgent.indexOf("Safari")>-1||navigator.userAgent.indexOf("keplerm")>-1)){window.addEventListener("scroll",function(){window.global_bottom_bar_pannel=document.querySelector("#commonNav");if(window.innerHeight>window.global_current_viewportHeight){window.global_bottom_bar_pannel.style.height="70PX"}else{window.global_bottom_bar_pannel.style.transition=".3s";window.global_bottom_bar_pannel.style.height="50PX"}})}};u.prototype._sendPingData=function(){var o=document.querySelectorAll("#commonNav .J_ping");for(var t=0,e=o.length;t<e;t++){o[t].addEventListener("click",function(o){o.stopPropagation();o.preventDefault();var t=this;try{r.mPing4Click(this.getAttribute("report-eventid"),location.href.split("?")[0],"")}catch(o){}setTimeout(function(){location.href=t.href},200)})}};u.prototype._showCart=function(){var o=m.getCookie("sid");var t="?sid="+o+"&t="+Date.now();s.ajax({url:a.CART_URL+t,method:"GET",data:{xxx:9},async:true,withCredentials:true,success:function(t){var e=document.querySelector("#mCommonCart .icon-center");t=JSON.parse(t);if(t){var n=0;try{if(!!t&&!!t.sid&&t.sid==o&&!!t.cartJson&&!!t.cartJson){var i=t.cartJson;if(i.resultCode==0&&i.cartInfo&&!!i.cartInfo.type){switch(i.cartInfo.type){case"1":e.innerHTML+="<span class='cart-money'></span>";break;default:n=!!i.cartInfo&&!!i.cartInfo.Num?parseInt(i.cartInfo.Num):0;n=parseInt(n);n>0&&(e.innerHTML+="<span class='cart-num'>"+(n>99?"99+":n)+"</span>");break}}var a=document.querySelector("#commonNav .cart-num");if(a&&navigator.platform=="iPhone"){a.style.fontSize="8PX"}}}catch(o){}}},error:function(o){}})};u.prototype._clearMy=function(){var o=document.querySelector("#mCommonMy");o.addEventListener("click",function(){s.jsonp({url:a.ClEAR_WAIT_PAY_URL,jsonp:"ClearUserRedPoint",data:{type:"4",sceneid:"2"},success:function(o){waitPayShow(o)},error:function(o){console.error(o)}})})};u.prototype._showMy=function(){s.jsonp({url:a.WAIT_PAY_URL,jsonp:"QueryUserRedPoint",data:{type:"4",sceneid:"2"},timeout:1200,success:function(t){try{o(t)}catch(o){console.error(o)}},error:function(o){console.log(o.message)}});function o(o){var t=o.data;if(!!!t){return}var e=t instanceof Array;var n=-1;if(!!e&&t.length>0){for(var i=0,a=t.length;i<a;i++){if(t[i]["msg_type"]==4){n=t[i].num}}}if(n>0){var c=document.querySelector("#mCommonMy .icon-center");c.innerHTML+='<span id="waitPay" class="wait-Pay"></span>';r.mPing4Click("MHome_WaitPayExpo",null,1)}else{var s=document.getElementById("waitPay");if(s){s.remove()}}}};(new u).init()})();